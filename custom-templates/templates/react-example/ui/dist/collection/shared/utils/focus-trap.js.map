{"version":3,"file":"focus-trap.js","sourceRoot":"","sources":["../../../src/shared/utils/focus-trap.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Copy/pasted from https://github.com/andreasbm/focus-trap\n */\n\n/**\n * Traverses the slots of the open shadowroots and returns all children matching the query.\n * We need to traverse each child-depth one at a time because if an element should be skipped\n * (for example because it is hidden) we need to skip all of it's children. If we use querySelectorAll(\"*\")\n * the information of whether the children is within a hidden parent is lost.\n * @param {ShadowRoot | HTMLElement} root\n * @param skipNode\n * @param isMatch\n * @param {number} maxDepth\n * @param {number} depth\n * @returns {HTMLElement[]}\n */\nexport function queryShadowRoot(\n\troot: ShadowRoot | HTMLElement,\n\tskipNode: ($elem: HTMLElement) => boolean,\n\tisMatch: ($elem: HTMLElement) => boolean,\n\tmaxDepth: number = 20,\n\tdepth: number = 0,\n): HTMLElement[] {\n\tconst matches: HTMLElement[] = [];\n\n\t// If the depth is above the max depth, abort the searching here.\n\tif (depth >= maxDepth) {\n\t\treturn matches;\n\t}\n\n\t// Traverses a slot element\n\tconst traverseSlot = ($slot: HTMLSlotElement) => {\n\t\t// Only check nodes that are of the type Node.ELEMENT_NODE\n\t\t// Read more here https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\n\t\tconst assignedNodes = $slot\n\t\t\t.assignedNodes()\n\t\t\t.filter((node) => node.nodeType === 1);\n\t\tif (assignedNodes.length > 0) {\n\t\t\tconst $slotParent = assignedNodes[0].parentElement!;\n\t\t\treturn queryShadowRoot(\n\t\t\t\t$slotParent,\n\t\t\t\tskipNode,\n\t\t\t\tisMatch,\n\t\t\t\tmaxDepth,\n\t\t\t\tdepth + 1,\n\t\t\t);\n\t\t}\n\n\t\treturn [];\n\t};\n\n\t// Go through each child and continue the traversing if necessary\n\t// Even though the typing says that children can't be undefined, Edge 15 sometimes gives an undefined value.\n\t// Therefore we fallback to an empty array if it is undefined.\n\tconst children = Array.from(root.children || []) as HTMLElement[];\n\tfor (const $child of children) {\n\t\t// Check if the element and its descendants should be skipped\n\t\tif (skipNode($child)) {\n\t\t\t// console.log('-- SKIP', $child);\n\t\t\tcontinue;\n\t\t}\n\n\t\t// console.log('$child', $child);\n\n\t\t// If the element matches we always add it\n\t\tif (isMatch($child)) {\n\t\t\tmatches.push($child);\n\t\t}\n\n\t\tif ($child.shadowRoot != null) {\n\t\t\t// If the element has a shadow root we need to traverse it\n\t\t\tmatches.push(\n\t\t\t\t...queryShadowRoot(\n\t\t\t\t\t$child.shadowRoot,\n\t\t\t\t\tskipNode,\n\t\t\t\t\tisMatch,\n\t\t\t\t\tmaxDepth,\n\t\t\t\t\tdepth + 1,\n\t\t\t\t),\n\t\t\t);\n\t\t} else if ($child.tagName === \"SLOT\") {\n\t\t\t// If the child is a slot we need to traverse each assigned node\n\t\t\tmatches.push(...traverseSlot($child as HTMLSlotElement));\n\t\t} else {\n\t\t\t// Traverse the children of the element\n\t\t\tmatches.push(\n\t\t\t\t...queryShadowRoot($child, skipNode, isMatch, maxDepth, depth + 1),\n\t\t\t);\n\t\t}\n\t}\n\n\treturn matches;\n}\n\n/**\n * Returns whether the element is hidden.\n * @param $elem\n */\nexport function isHidden($elem: HTMLElement): boolean {\n\treturn (\n\t\t$elem.hasAttribute(\"hidden\") ||\n\t\t($elem.hasAttribute(\"aria-hidden\") &&\n\t\t\t$elem.getAttribute(\"aria-hidden\") !== \"false\") ||\n\t\t// A quick and dirty way to check whether the element is hidden.\n\t\t// For a more fine-grained check we could use \"window.getComputedStyle\" but we don't because of bad performance.\n\t\t// If the element has visibility set to \"hidden\" or \"collapse\", display set to \"none\" or opacity set to \"0\" through CSS\n\t\t// we won't be able to catch it here. We accept it due to the huge performance benefits.\n\t\t$elem.style.display === `none` ||\n\t\t$elem.style.opacity === `0` ||\n\t\t$elem.style.visibility === `hidden` ||\n\t\t$elem.style.visibility === `collapse`\n\t);\n\n\t// If offsetParent is null we can assume that the element is hidden\n\t// https://stackoverflow.com/questions/306305/what-would-make-offsetparent-null\n\t// || $elem.offsetParent == null;\n}\n\n/**\n * Returns whether the element is disabled.\n * @param $elem\n */\nexport function isDisabled($elem: HTMLElement): boolean {\n\treturn (\n\t\t$elem.hasAttribute(\"disabled\") ||\n\t\t($elem.hasAttribute(\"aria-disabled\") &&\n\t\t\t$elem.getAttribute(\"aria-disabled\") !== \"false\")\n\t);\n}\n\n/**\n * Determines whether an element is focusable.\n * Read more here: https://stackoverflow.com/questions/1599660/which-html-elements-can-receive-focus/1600194#1600194\n * Or here: https://stackoverflow.com/questions/18261595/how-to-check-if-a-dom-element-is-focusable\n * @param $elem\n */\nexport function isFocusable($elem: HTMLElement): boolean {\n\t// Discard elements that are removed from the tab order.\n\tif (\n\t\t$elem.getAttribute(\"tabindex\") === \"-1\" ||\n\t\tisHidden($elem) ||\n\t\tisDisabled($elem)\n\t) {\n\t\treturn false;\n\t}\n\n\treturn (\n\t\t// At this point we know that the element can have focus (eg. won't be -1) if the tabindex attribute exists\n\t\t$elem.hasAttribute(\"tabindex\") ||\n\t\t// Anchor tags or area tags with a href set\n\t\t(($elem instanceof HTMLAnchorElement || $elem instanceof HTMLAreaElement) &&\n\t\t\t$elem.hasAttribute(\"href\")) ||\n\t\t// Form elements which are not disabled\n\t\t$elem instanceof HTMLButtonElement ||\n\t\t$elem instanceof HTMLInputElement ||\n\t\t$elem instanceof HTMLTextAreaElement ||\n\t\t$elem instanceof HTMLSelectElement ||\n\t\t// IFrames\n\t\t$elem instanceof HTMLIFrameElement\n\t);\n}\n"]}