{"version":3,"names":["dropdownCss","Dropdown","__stencil_proxyCustomElement","HTMLElement","placement","defaultOpen","internalIsOpen","noAppendToBody","ifxOpen","ifxClose","ifxDropdown","disabled","noCloseOnOutsideClick","noCloseOnMenuClick","trigger","menu","popperInstance","handleOutsideClick","event","target","this","el","contains","closeDropdown","handleFocusOutside","handleTriggerClick","openDropdown","handleTriggerKeyDown","e","key","shiftKey","preventDefault","focusFirstItem","handleMenuClick","getItemFocusables","hosts","Array","from","querySelectorAll","filter","h","getAttribute","classList","map","shadowRoot","querySelector","handleMenuKeyDown","items","length","i","indexOf","document","activeElement","focus","click","componentWillLoad","updateSlotContent","watchHandlerIsOpen","componentDidLoad","isNestedInIfxComponent","framework","detectFramework","trackComponent","newValue","oldValue","watchHandlerDisabled","watchHandlerSlot","first","newTrigger","removeEventListener","addEventListener","newMenu","remove","body","append","menuClickHandler","disconnectedCallback","destroy","isOpen","emit","createPopper","render","class"],"sources":["src/components/dropdown/dropdown.scss?tag=ifx-dropdown&encapsulation=shadow","src/components/dropdown/dropdown.tsx"],"sourcesContent":["@use \"~@infineon/design-system-tokens/dist/tokens\";\n\n:host {\n    display: inline-block;\n}","import { createPopper } from \"@popperjs/core\";\nimport {\n\tComponent,\n\tElement,\n\tEvent,\n\ttype EventEmitter,\n\th,\n\tListen,\n\tMethod,\n\tProp,\n\tState,\n\tWatch,\n} from \"@stencil/core\";\nimport { isNestedInIfxComponent } from \"../../shared/utils/dom-utils\";\nimport { detectFramework } from \"../../shared/utils/framework-detection\";\nimport { trackComponent } from \"../../shared/utils/tracking\";\n\nimport type { IOpenable } from \"./IOpenable\";\n\nexport type Placement =\n\t| \"auto\"\n\t| \"auto-start\"\n\t| \"auto-end\"\n\t| \"top\"\n\t| \"top-start\"\n\t| \"top-end\"\n\t| \"bottom\"\n\t| \"bottom-start\"\n\t| \"bottom-end\"\n\t| \"right\"\n\t| \"right-start\"\n\t| \"right-end\"\n\t| \"left\"\n\t| \"left-start\"\n\t| \"left-end\";\n\n@Component({\n\ttag: \"ifx-dropdown\",\n\tstyleUrl: \"dropdown.scss\",\n\tshadow: true,\n})\nexport class Dropdown {\n\t@Prop() placement: Placement = \"bottom-start\";\n\t@Prop() defaultOpen: boolean = false;\n\t@State() internalIsOpen: boolean = false;\n\t@Prop() noAppendToBody: boolean = false;\n\t@Event() ifxOpen: EventEmitter;\n\t@Event() ifxClose: EventEmitter;\n\t@Event() ifxDropdown: EventEmitter;\n\t@Prop() disabled: boolean;\n\t@Prop() noCloseOnOutsideClick: boolean = false;\n\t@Prop() noCloseOnMenuClick: boolean = false;\n\t@Element() el;\n\t@State() trigger: HTMLElement;\n\t@State() menu: HTMLElement;\n\t// Popper instance for positioning\n\tpopperInstance: any;\n\n\t@Listen(\"mousedown\", { target: \"document\" })\n\thandleOutsideClick(event: MouseEvent) {\n\t\tconst target = event.target as HTMLElement;\n\n\t\tif (\n\t\t\t!this.noCloseOnOutsideClick &&\n\t\t\t!this.el.contains(target) &&\n\t\t\t!this.menu.contains(target)\n\t\t) {\n\t\t\tthis.closeDropdown();\n\t\t}\n\t}\n\n\t@Listen(\"focusin\", { target: \"document\" })\n\thandleFocusOutside(event: FocusEvent) {\n\t\tconst target = event.target as HTMLElement;\n\t\tif (\n\t\t\tthis.internalIsOpen &&\n\t\t\t!this.el.contains(target) &&\n\t\t\t!this.menu.contains(target)\n\t\t) {\n\t\t\tthis.closeDropdown();\n\t\t}\n\t}\n\n\tprivate handleTriggerClick = () => {\n\t\tif (!this.internalIsOpen) this.openDropdown();\n\t\telse this.closeDropdown();\n\t};\n\n\tprivate handleTriggerKeyDown = (e: KeyboardEvent) => {\n\t\tconst key = e.key;\n\t\tif (key === \"Tab\" && this.internalIsOpen && !e.shiftKey) {\n\t\t\te.preventDefault();\n\t\t\tthis.focusFirstItem();\n\t\t}\n\t};\n\n\tprivate handleMenuClick = () => {\n\t\tif (!this.noCloseOnMenuClick) this.closeDropdown();\n\t};\n\n\tprivate getItemFocusables(): HTMLElement[] {\n\t\tif (!this.menu) return [];\n\t\tconst hosts = Array.from(\n\t\t\tthis.menu.querySelectorAll<HTMLElement>(\"ifx-dropdown-item\"),\n\t\t);\n\t\treturn hosts\n\t\t\t.filter(\n\t\t\t\t(h) =>\n\t\t\t\t\t!(h.getAttribute(\"hide\") === \"true\" || h.classList.contains(\"hide\")),\n\t\t\t)\n\t\t\t.map((h) => h.shadowRoot?.querySelector(\"a\") as HTMLElement | null)\n\t\t\t.filter((el): el is HTMLElement => !!el);\n\t}\n\n\tprivate handleMenuKeyDown = (e: KeyboardEvent) => {\n\t\tconst items = this.getItemFocusables();\n\t\tif (!items.length) return;\n\n\t\tconst i = items.indexOf(document.activeElement as HTMLElement);\n\n\t\tswitch (e.key) {\n\t\t\tcase \"ArrowDown\":\n\t\t\t\te.preventDefault();\n\t\t\t\titems[(i + 1) % items.length].focus();\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowUp\":\n\t\t\t\te.preventDefault();\n\t\t\t\titems[(i - 1 + items.length) % items.length].focus();\n\t\t\t\tbreak;\n\t\t\tcase \"Home\":\n\t\t\t\te.preventDefault();\n\t\t\t\titems[0].focus();\n\t\t\t\tbreak;\n\t\t\tcase \"End\":\n\t\t\t\te.preventDefault();\n\t\t\t\titems[items.length - 1].focus();\n\t\t\t\tbreak;\n\t\t\tcase \"Enter\":\n\t\t\tcase \" \":\n\t\t\tcase \"Spacebar\":\n\t\t\t\te.preventDefault();\n\t\t\t\t(document.activeElement as HTMLElement)?.click();\n\t\t\t\tbreak;\n\t\t\tcase \"Escape\":\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.closeDropdown();\n\t\t\t\t(this.trigger as HTMLElement)?.focus();\n\t\t\t\tbreak;\n\t\t\tcase \"Tab\":\n\t\t\t\tif (e.shiftKey && i === 0) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.closeDropdown();\n\t\t\t\t\t(this.trigger as HTMLElement)?.focus();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tcomponentWillLoad() {\n\t\t//maybe not needed\n\t\tthis.updateSlotContent();\n\t\tthis.watchHandlerIsOpen(this.defaultOpen, this.internalIsOpen);\n\t}\n\n\tasync componentDidLoad() {\n\t\tif (!isNestedInIfxComponent(this.el)) {\n\t\t\tconst framework = detectFramework();\n\t\t\ttrackComponent(\"ifx-dropdown\", await framework);\n\t\t}\n\t}\n\n\t@Watch(\"defaultOpen\")\n\twatchHandlerIsOpen(newValue: boolean, oldValue: boolean) {\n\t\tif (newValue !== oldValue && newValue !== this.internalIsOpen) {\n\t\t\tif (newValue) {\n\t\t\t\tthis.openDropdown();\n\t\t\t} else {\n\t\t\t\tthis.closeDropdown();\n\t\t\t}\n\t\t}\n\t}\n\n\t@Watch(\"disabled\")\n\twatchHandlerDisabled(newValue: boolean) {\n\t\tif (this.trigger) {\n\t\t\t(\n\t\t\t\tthis.trigger as undefined as HTMLIfxDropdownTriggerButtonElement\n\t\t\t).disabled = newValue;\n\t\t}\n\t}\n\n\t@Listen(\"slotchange\")\n\twatchHandlerSlot() {\n\t\tthis.updateSlotContent();\n\t}\n\n\tprivate focusFirstItem() {\n\t\tconst [first] = this.getItemFocusables();\n\t\tfirst?.focus();\n\t}\n\n\tupdateSlotContent() {\n\t\tconst newTrigger = this.el.querySelector(\n\t\t\t\"ifx-dropdown-trigger-button, ifx-dropdown-trigger\",\n\t\t) as HTMLElement | null;\n\n\t\tif (newTrigger !== this.trigger) {\n\t\t\tif (this.trigger) {\n\t\t\t\tthis.trigger.removeEventListener(\"click\", this.handleTriggerClick);\n\t\t\t\tthis.trigger.removeEventListener(\"keydown\", this.handleTriggerKeyDown);\n\t\t\t}\n\t\t\tthis.trigger = newTrigger!;\n\t\t\tif (this.trigger) {\n\t\t\t\t(this.trigger as any).disabled = this.disabled;\n\t\t\t\tthis.trigger.addEventListener(\"click\", this.handleTriggerClick);\n\t\t\t\tthis.trigger.addEventListener(\"keydown\", this.handleTriggerKeyDown);\n\t\t\t}\n\t\t}\n\n\t\tconst newMenu = this.el.querySelector(\n\t\t\t\"ifx-dropdown-menu\",\n\t\t) as HTMLElement | null;\n\n\t\tif (!this.noAppendToBody) {\n\t\t\tif (this.menu && this.menu !== newMenu) {\n\t\t\t\tthis.menu.removeEventListener(\"click\", this.handleMenuClick);\n\t\t\t\tthis.menu.removeEventListener(\"keydown\", this.handleMenuKeyDown);\n\t\t\t\tthis.menu.remove();\n\t\t\t}\n\t\t\tthis.menu = newMenu!;\n\t\t\tif (this.menu && !document.body.contains(this.menu)) {\n\t\t\t\tdocument.body.append(this.menu);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.menu = newMenu!;\n\t\t}\n\n\t\tif (this.menu) {\n\t\t\tthis.menu.removeEventListener(\"click\", this.handleMenuClick);\n\t\t\tthis.menu.removeEventListener(\"keydown\", this.handleMenuKeyDown);\n\t\t\tthis.menu.addEventListener(\"click\", this.handleMenuClick);\n\t\t\tthis.menu.addEventListener(\"keydown\", this.handleMenuKeyDown);\n\t\t}\n\t}\n\n\tmenuClickHandler() {\n\t\tif (!this.noCloseOnMenuClick) {\n\t\t\tthis.closeDropdown();\n\t\t}\n\t}\n\n\tdisconnectedCallback() {\n\t\tif (this.popperInstance) {\n\t\t\tthis.popperInstance.destroy();\n\t\t\tthis.popperInstance = null;\n\t\t}\n\n\t\tif (this.menu) {\n\t\t\tthis.menu.remove();\n\t\t}\n\t}\n\n\t@Method()\n\tasync isOpen() {\n\t\treturn this.internalIsOpen;\n\t}\n\n\t@Method()\n\tasync closeDropdown() {\n\t\tif (this.internalIsOpen) {\n\t\t\tthis.internalIsOpen = false;\n\n\t\t\t(this.trigger as unknown as IOpenable).isOpen = false;\n\t\t\t(this.menu as unknown as IOpenable).isOpen = false;\n\n\t\t\tthis.ifxClose.emit();\n\t\t}\n\n\t\tif (this.popperInstance) {\n\t\t\tthis.popperInstance.destroy();\n\t\t\tthis.popperInstance = null;\n\t\t}\n\t}\n\n\t@Method()\n\tasync openDropdown() {\n\t\tif (!this.internalIsOpen && !this.disabled) {\n\t\t\tthis.internalIsOpen = true;\n\t\t\t(this.trigger as any).isOpen = true;\n\t\t\t(this.menu as any).isOpen = true;\n\t\t\tthis.popperInstance = createPopper(this.el, this.menu, {\n\t\t\t\tplacement: this.placement,\n\t\t\t});\n\t\t\tthis.ifxOpen.emit();\n\t\t}\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div aria-label=\"dropdown menu\" class=\"dropdown\">\n\t\t\t\t<slot />\n\t\t\t</div>\n\t\t);\n\t}\n}\n"],"mappings":"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","ignoreList":[]}